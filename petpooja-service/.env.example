# A24 Restaurant Data Pipeline - Configuration Example
# Copy this file to .env and update with your actual values

# =============================================================================
# Database Configuration - SHARED WITH RESTAURANT-CHATBOT
# =============================================================================
# ⚠️ IMPORTANT: Both petpooja-service and restaurant-chatbot now share the same database!
# Use 'postgres' as host when running in Docker Compose
# Use 'localhost' as host when running locally for development

# For Docker Compose (uncomment when deploying):
# POSTGRES_HOST=postgres
# For Local Development (uncomment when running locally):
POSTGRES_HOST=localhost

# Shared database settings (from docker-compose.root.yml)
POSTGRES_PORT=5432
POSTGRES_DB=restaurant_ai
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin123

# Database Connection Pool Settings (Sync)
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=1800
DB_STATEMENT_TIMEOUT=30000
DB_EXECUTOR_MAX_WORKERS=2

# Database Connection Pool Settings (Async)
DB_ASYNC_POOL_SIZE=20
DB_ASYNC_MAX_OVERFLOW=40
DB_ASYNC_POOL_TIMEOUT=30
DB_ASYNC_POOL_RECYCLE=1800

# =============================================================================
# PetPooja API Configuration
# =============================================================================
# Production API Base URL
PETPOOJA_BASE_URL=https://api-v2.petpooja.com

# NOTE: PetPooja credentials (app_key, app_secret, access_token, restaurant_id)
# should be passed via API request body, NOT stored in .env
# See: /api/chain/fetch-petpooja and /api/chain/store-menu endpoints

# =============================================================================
# PetPooja Sandbox Configuration (Testing)
# =============================================================================
# Set to true to use sandbox environment, false for production
PETPOOJA_SANDBOX_ENABLED=true
PETPOOJA_SANDBOX_BASE_URL=https://qle1yy2ydc.execute-api.ap-southeast-1.amazonaws.com/V1
PETPOOJA_SANDBOX_ORDER_URL=https://47pfzh5sf2.execute-api.ap-southeast-1.amazonaws.com/V1
PETPOOJA_SANDBOX_UPDATE_ORDER_URL=https://qle1yy2ydc.execute-api.ap-southeast-1.amazonaws.com/V1/update_order_status
PETPOOJA_SANDBOX_DASHBOARD_URL=https://developerapi.petpooja.com

# NOTE: Sandbox credentials should also be passed via API request
# Do NOT hardcode app_key, app_secret, access_token here

# AWS Credentials for API Gateway (Sandbox)
# Only needed if using AWS Signature Version 4 authentication
# Leave empty unless specifically required by PetPooja
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_REGION=ap-southeast-1

# =============================================================================
# PetPooja API Endpoints
# =============================================================================
PETPOOJA_SAVE_ORDER_ENDPOINT=/save_order
PETPOOJA_FETCH_MENU_ENDPOINT=/mapped_restaurant_menus
PETPOOJA_FETCH_RESTAURANT_ENDPOINT=/getrestaurantdetails

# =============================================================================
# Webhook & Callback Configuration
# =============================================================================
# IMPORTANT: Update this with your public URL for production
# For local testing: Use ngrok URL (e.g., https://abc123.ngrok.io)
# For production: Use your domain (e.g., https://api.yourdomain.com)
PETPOOJA_CALLBACK_URL=http://localhost:8001/api/webhooks/petpooja/order-status

# Webhook Security Secret (for HMAC signature verification)
# Change this to a secure random string in production
WEBHOOK_SECRET=your-secure-webhook-secret-here

# Webhook base path
PETPOOJA_WEBHOOK_ENDPOINT=/webhook

# Configure these URLs in PetPooja Dashboard:
# - Order Status Callback: {YOUR_URL}/api/webhooks/petpooja/order-status
# - Delivery Status Callback: {YOUR_URL}/api/webhooks/petpooja/delivery-status
# - Order Cancellation Callback: {YOUR_URL}/api/webhooks/petpooja/order-cancellation
# - Webhook Test: {YOUR_URL}/api/webhooks/petpooja/test

# =============================================================================
# Main Backend Integration
# =============================================================================
MAIN_BACKEND_URL=http://localhost:3000
# Change this to a secure token in production
MAIN_BACKEND_API_TOKEN=your-backend-api-token-here
MAIN_BACKEND_WEBHOOK_ENDPOINT=/api/webhooks/petpooja

# =============================================================================
# API Server Configuration
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8001
API_WORKERS=4
API_RELOAD=true
API_LOG_LEVEL=info
DEBUG=true

# Application Info
APP_NAME=A24 Restaurant Data Pipeline
APP_VERSION=1.0.0

# =============================================================================
# Logging Configuration
# =============================================================================
LOG_LEVEL=INFO
LOG_FILE=logs/petpooja_microservice.log

# =============================================================================
# HTTP Client Configuration
# =============================================================================
HTTP_TIMEOUT=30
HTTP_MAX_RETRIES=3
HTTP_RETRY_DELAY=2

# HTTP Connection Pool Settings
HTTPX_MAX_KEEPALIVE_CONNECTIONS=20
HTTPX_MAX_CONNECTIONS=100

# Credentials Cache Configuration
CREDENTIALS_CACHE_TTL_SECONDS=300

# =============================================================================
# Security Settings
# =============================================================================
# Encryption key for sensitive data (32-byte base64 encoded)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# IMPORTANT: Change this in production!
ENCRYPTION_KEY="your-32-byte-base64-encoded-key-here"

# CORS Configuration (comma-separated origins or * for all)
# In production, specify exact origins instead of *
ALLOWED_ORIGINS=*

# Rate limiting (requests per minute per IP)
RATE_LIMIT_PER_MINUTE=60

# =============================================================================
# Order Processing Configuration
# =============================================================================
# Order ID prefix for generating order IDs
ORDER_ID_PREFIX=A24-

# PetPooja order device identification
PETPOOJA_ORDER_UDID=a24-pipeline
PETPOOJA_ORDER_DEVICE_TYPE=Web

# Order timing configuration (in minutes)
DEFAULT_PREP_TIME_OFFSET_MINUTES=30
MIN_PREP_TIME_MINUTES=20
URGENT_ORDER_TIME_MINUTES=30
